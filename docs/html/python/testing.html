<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>pytest &#8212; PowrUsr Docs alpha documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=aa5eeaf2" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=b20cc3f5" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c6eb1e0f" />
    
    <script src="../_static/documentation_options.js?v=1f169f65"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="regex" href="regex.html" /><link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Logo"/>
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" />
                <input type="submit" value="Go"/>
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label>
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../sphinx.html">sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/awk.html">awk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/find.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/scripting.html">scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html">line selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#append-insert-delete-actions">append insert delete actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#substitute">substitute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#grouping-expressions">grouping expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="assert.html">assert python</a></li>
<li class="toctree-l1"><a class="reference internal" href="assert.html#assert-pandas">assert pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataclass.html">dataclasses</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_ops.html">glob</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional.html">functional programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html">fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#syncronize-iterations-over-2-iterable-series">syncronize iterations over 2 iterable series</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#eg-two-series-of-temperature-data">eg two  series of temperature data</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#bind-them-in-pairs-of-corresponding-readings">bind them in pairs of corresponding readings</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#zip-yields-tuples-when-iterated">zip yields tuples when iterated</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-can-take-advantage-of-this-with-tuple-unpacking-in-the-for-loop">we can take advantage of this with tuple unpacking in the for loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#now-we-want-one-long-temperature-series-for-sunday-monday-and-thuesday">now we want one long temperature series for sunday monday and thuesday</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-can-then-lazily-concatenate-iterables-using-itertools-chain">we can then lazily concatenate iterables using itertools chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#this-is-different-from-simply-concatenating-3-lists-into-a-new-list">this is different from simply concatenating 3 lists into a new list</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-have-no-memory-impact-of-data-duplication">we have no memory impact of data duplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#following-shows-generator-functions-generator-expressions-predicate-functions-and-for-loops">following shows generator functions, generator expressions, predicate functions and for loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="generator.html">generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">code library</a></li>
<li class="toctree-l1"><a class="reference internal" href="regex.html">regex</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pytest</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pytest-ini">pytest.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skip-slow">skip &amp; slow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fixtures">fixtures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#capsys">capsys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conftest-py">conftest.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assertions-on-expected-exceptions">assertions on expected exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametrize">parametrize</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parametrize-all-test-in-module">parametrize all test in module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mark-individual-test-instances-within-parametrize">mark individual test instances within parametrize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stacking-parametrize-decorators">stacking parametrize decorators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#test-doubles">test doubles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stubs">stubs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fakes">fakes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stringio">StringIO</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dummies">dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spies">spies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#manual-spy">manual spy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-unittest-mock-spy">using unittest.mock spy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mocks">mocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#approval-tests">approval tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verify-string">verify string</a></li>
<li class="toctree-l3"><a class="reference internal" href="#best-covering-pairs">best covering pairs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-advanced-combination-approvals">more advanced combination approvals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#coverage">coverage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exclude-branches">exclude branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytest-runner-cov-plugin">pytest runner cov plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#monkeypatching">monkeypatching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vcrpy-pytest-recording">VCRpy &amp; pytest-recording</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage-with-pytest">usage with pytest</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </nav>
    </div>
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="regex.html" title="regex"
             accesskey="P">previous</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">PowrUsr Docs alpha documentation</a> &#187;
              
          </li>
        <li class="nav-item nav-item-this"><a href="">pytest</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" id="search-box" />
          <input type="submit" value="Go" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pytest">
<h1>pytest<a class="headerlink" href="#pytest" title="Link to this heading">¶</a></h1>
<section id="installation">
<h2>installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://docs.pytest.org">pytest docs</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>pytest
pytest<span class="w"> </span>--version
</pre></div>
</div>
</section>
<section id="pytest-ini">
<h2>pytest.ini<a class="headerlink" href="#pytest-ini" title="Link to this heading">¶</a></h2>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">--strict-markers</span>
<span class="na">markers</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">slow</span><span class="o">:</span><span class="w"> </span><span class="s">Run tests that use sample data from file (deselect with &#39;-m &quot;not slow&quot;&#39;)</span>
</pre></div>
</div>
</section>
<section id="skip-slow">
<h2>skip &amp; slow<a class="headerlink" href="#skip-slow" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;work in process&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_some_new_feature</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">False</span> <span class="c1"># test should fail</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">def</span> <span class="nf">test_large_file</span><span class="p">(</span><span class="n">phonebook</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;test_data.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Phone Number&quot;</span><span class="p">]</span>
            <span class="n">phonebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">phonebook</span><span class="o">.</span><span class="n">is_consistent</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">reason</span><span class="o">=</span><span class="err">“</span><span class="n">requires</span> <span class="n">python3</span><span class="mf">.6</span> <span class="ow">or</span> <span class="n">higher</span><span class="err">”</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_phonebook_contains_names</span><span class="p">():</span>
    <span class="n">phonebook</span> <span class="o">=</span> <span class="n">PhoneBook</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;Bob&#39;</span> <span class="ow">in</span> <span class="n">phonebook</span><span class="o">.</span><span class="n">names</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># run all tests except slow</span>
python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span><span class="s2">&quot;not slow&quot;</span>
</pre></div>
</div>
</section>
<section id="fixtures">
<h2>fixtures<a class="headerlink" href="#fixtures" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://docs.pytest.org/en/7.4.x/reference/fixtures.html#fixtures">fixtures</a></p>
<p>Fixture availability is determined from the perspective of the test. A fixture is only available for tests to request if they are in the scope that fixture is defined in.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--fixtures
<span class="o">=========================================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">=========================================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.10.12,<span class="w"> </span>pytest-7.4.3,<span class="w"> </span>pluggy-1.3.0
rootdir:<span class="w"> </span>/home/duke/gh/docs
collected<span class="w"> </span><span class="m">0</span><span class="w"> </span>items<span class="w">                                                                                     </span>
cache<span class="w"> </span>--<span class="w"> </span>.../_pytest/cacheprovider.py:532
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>cache<span class="w"> </span>object<span class="w"> </span>that<span class="w"> </span>can<span class="w"> </span>persist<span class="w"> </span>state<span class="w"> </span>between<span class="w"> </span>testing<span class="w"> </span>sessions.

capsysbinary<span class="w"> </span>--<span class="w"> </span>.../_pytest/capture.py:1001
<span class="w">    </span>Enable<span class="w"> </span>bytes<span class="w"> </span>capturing<span class="w"> </span>of<span class="w"> </span>writes<span class="w"> </span>to<span class="w"> </span><span class="sb">``</span>sys.stdout<span class="sb">``</span><span class="w"> </span>and<span class="w"> </span><span class="sb">``</span>sys.stderr<span class="sb">``</span>.

capfd<span class="w"> </span>--<span class="w"> </span>.../_pytest/capture.py:1029
<span class="w">    </span>Enable<span class="w"> </span>text<span class="w"> </span>capturing<span class="w"> </span>of<span class="w"> </span>writes<span class="w"> </span>to<span class="w"> </span>file<span class="w"> </span>descriptors<span class="w"> </span><span class="sb">``</span><span class="m">1</span><span class="sb">``</span><span class="w"> </span>and<span class="w"> </span><span class="sb">``</span><span class="m">2</span><span class="sb">``</span>.

capfdbinary<span class="w"> </span>--<span class="w"> </span>.../_pytest/capture.py:1057
<span class="w">    </span>Enable<span class="w"> </span>bytes<span class="w"> </span>capturing<span class="w"> </span>of<span class="w"> </span>writes<span class="w"> </span>to<span class="w"> </span>file<span class="w"> </span>descriptors<span class="w"> </span><span class="sb">``</span><span class="m">1</span><span class="sb">``</span><span class="w"> </span>and<span class="w"> </span><span class="sb">``</span><span class="m">2</span><span class="sb">``</span>.

capsys<span class="w"> </span>--<span class="w"> </span>.../_pytest/capture.py:973
<span class="w">    </span>Enable<span class="w"> </span>text<span class="w"> </span>capturing<span class="w"> </span>of<span class="w"> </span>writes<span class="w"> </span>to<span class="w"> </span><span class="sb">``</span>sys.stdout<span class="sb">``</span><span class="w"> </span>and<span class="w"> </span><span class="sb">``</span>sys.stderr<span class="sb">``</span>.

doctest_namespace<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>scope<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>.../_pytest/doctest.py:757
<span class="w">    </span>Fixture<span class="w"> </span>that<span class="w"> </span>returns<span class="w"> </span>a<span class="w"> </span>:py:class:<span class="sb">`</span>dict<span class="sb">`</span><span class="w"> </span>that<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>injected<span class="w"> </span>into<span class="w"> </span>the
<span class="w">    </span>namespace<span class="w"> </span>of<span class="w"> </span>doctests.

pytestconfig<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>scope<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>.../_pytest/fixtures.py:1353
<span class="w">    </span>Session-scoped<span class="w"> </span>fixture<span class="w"> </span>that<span class="w"> </span>returns<span class="w"> </span>the<span class="w"> </span>session<span class="err">&#39;</span>s<span class="w"> </span>:class:<span class="sb">`</span>pytest.Config<span class="sb">`</span>
<span class="w">    </span>object.

record_property<span class="w"> </span>--<span class="w"> </span>.../_pytest/junitxml.py:282
<span class="w">    </span>Add<span class="w"> </span>extra<span class="w"> </span>properties<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>calling<span class="w"> </span>test.

record_xml_attribute<span class="w"> </span>--<span class="w"> </span>.../_pytest/junitxml.py:305
<span class="w">    </span>Add<span class="w"> </span>extra<span class="w"> </span>xml<span class="w"> </span>attributes<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>tag<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>calling<span class="w"> </span>test.

record_testsuite_property<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>scope<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>.../_pytest/junitxml.py:343
<span class="w">    </span>Record<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span><span class="sb">``</span>&lt;property&gt;<span class="sb">``</span><span class="w"> </span>tag<span class="w"> </span>as<span class="w"> </span>child<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>root<span class="w"> </span><span class="sb">``</span>&lt;testsuite&gt;<span class="sb">``</span>.

tmpdir_factory<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>scope<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>.../_pytest/legacypath.py:302
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>:class:<span class="sb">`</span>pytest.TempdirFactory<span class="sb">`</span><span class="w"> </span>instance<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="nb">test</span><span class="w"> </span>session.

tmpdir<span class="w"> </span>--<span class="w"> </span>.../_pytest/legacypath.py:309
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>temporary<span class="w"> </span>directory<span class="w"> </span>path<span class="w"> </span>object<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>unique<span class="w"> </span>to<span class="w"> </span>each<span class="w"> </span><span class="nb">test</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span>invocation,<span class="w"> </span>created<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>sub<span class="w"> </span>directory<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>base<span class="w"> </span>temporary
<span class="w">    </span>directory.

caplog<span class="w"> </span>--<span class="w"> </span>.../_pytest/logging.py:570
<span class="w">    </span>Access<span class="w"> </span>and<span class="w"> </span>control<span class="w"> </span>log<span class="w"> </span>capturing.

monkeypatch<span class="w"> </span>--<span class="w"> </span>.../_pytest/monkeypatch.py:30
<span class="w">    </span>A<span class="w"> </span>convenient<span class="w"> </span>fixture<span class="w"> </span><span class="k">for</span><span class="w"> </span>monkey-patching.

recwarn<span class="w"> </span>--<span class="w"> </span>.../_pytest/recwarn.py:30
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>:class:<span class="sb">`</span>WarningsRecorder<span class="sb">`</span><span class="w"> </span>instance<span class="w"> </span>that<span class="w"> </span>records<span class="w"> </span>all<span class="w"> </span>warnings<span class="w"> </span>emitted<span class="w"> </span>by<span class="w"> </span><span class="nb">test</span><span class="w"> </span>functions.

tmp_path_factory<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>scope<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>.../_pytest/tmpdir.py:245
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>:class:<span class="sb">`</span>pytest.TempPathFactory<span class="sb">`</span><span class="w"> </span>instance<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="nb">test</span><span class="w"> </span>session.

tmp_path<span class="w"> </span>--<span class="w"> </span>.../_pytest/tmpdir.py:260
<span class="w">    </span>Return<span class="w"> </span>a<span class="w"> </span>temporary<span class="w"> </span>directory<span class="w"> </span>path<span class="w"> </span>object<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>unique<span class="w"> </span>to<span class="w"> </span>each<span class="w"> </span><span class="nb">test</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span>invocation,<span class="w"> </span>created<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>sub<span class="w"> </span>directory<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>base<span class="w"> </span>temporary
<span class="w">    </span>directory.
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">phonebook</span><span class="p">():</span>
<span class="k">return</span> <span class="n">PhoneBook</span><span class="p">()</span>

<span class="c1"># using phonebook fixture</span>
<span class="k">def</span> <span class="nf">test_lookup_by_name</span><span class="p">(</span><span class="n">phonebook</span><span class="p">):</span>
<span class="n">phonebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;12345&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;12345&quot;</span> <span class="o">==</span> <span class="n">phonebook</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="err">“</span><span class="n">Bob</span><span class="s2">&quot;)</span>

<span class="c1"># using phonebook fixture</span>
<span class="k">def</span> <span class="nf">test_missing_name_raises_error</span><span class="p">(</span><span class="n">phonebook</span><span class="p">):</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
<span class="n">phonebook</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="capsys">
<h3>capsys<a class="headerlink" href="#capsys" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_print_fizzbuzz</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
    <span class="n">print_fizzbuzz</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">captured_stdout</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
    <span class="k">assert</span> <span class="n">captured_stdout</span> <span class="o">==</span> <span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">2</span><span class="se">\n</span><span class="s2">Fizz</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="conftest-py">
<h3>conftest.py<a class="headerlink" href="#conftest-py" title="Link to this heading">¶</a></h3>
<p>share fixtures across multiple files</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Shared fixtures&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">phonebook.phonenumbers</span> <span class="kn">import</span> <span class="n">Phonebook</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">phonebook</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides an empty Phonebook&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Phonebook</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of tests/conftest.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">innermost</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="assertions-on-expected-exceptions">
<h2>assertions on expected exceptions<a class="headerlink" href="#assertions-on-expected-exceptions" title="Link to this heading">¶</a></h2>
<p>use pytest.raises() as context manager to write assertions on exceptions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_zero_division</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">test_missing_name_raises_error</span><span class="p">(</span><span class="n">phonebook</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
        <span class="n">phonebook</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">myfunc</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Exception 123 raised&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_match</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.* 123 .*&quot;</span><span class="p">):</span>
        <span class="n">myfunc</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">raises</span><span class="o">=</span><span class="ne">IndexError</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_f</span><span class="p">():</span>
    <span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="parametrize">
<h2>parametrize<a class="headerlink" href="#parametrize" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;3+5&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2+4&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;6*9&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;n,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="k">class</span> <span class="nc">TestClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_weird_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>




<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;entry1,entry2,is_consistent&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">((</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;12345&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Anna&quot;</span><span class="p">,</span> <span class="s2">&quot;01234&quot;</span><span class="p">),</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">((</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;12345&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Sue&quot;</span><span class="p">,</span> <span class="s2">&quot;12345&quot;</span><span class="p">),</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">((</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;12345&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Sue&quot;</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">),</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_is_consistent</span><span class="p">(</span><span class="n">phonebook</span><span class="p">,</span> <span class="n">entry1</span><span class="p">,</span> <span class="n">entry2</span><span class="p">,</span> <span class="n">is_consistent</span><span class="p">):</span>
    <span class="n">phonebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">entry1</span><span class="p">)</span>
    <span class="n">phonebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">entry2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">phonebook</span><span class="o">.</span><span class="n">is_consistent</span><span class="p">()</span> <span class="o">==</span> <span class="n">is_consistent</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;dice,expected_score&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">8</span><span class="p">),</span>
        <span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">28</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_full_house</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">expected_score</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">full_house</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_score</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;dice,expected_categories&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
         <span class="p">[(</span><span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;large_straight&#39;</span><span class="p">),(</span><span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;chance&#39;</span><span class="p">),(</span><span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;small_straight&#39;</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;fives&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;fours&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;threes&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;twos&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ones&#39;</span><span class="p">)]),</span>
        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="p">[(</span><span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;full_house&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;chance&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;two_pairs&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;three_of_a_kind&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;threes&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;twos&#39;</span><span class="p">)]),</span>
        <span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="p">[(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;yatzi&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;sixes&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;chance&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;four_of_a_kind&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;three_of_a_kind&#39;</span><span class="p">)]),</span>
    <span class="p">])</span>
<span class="k">def</span> <span class="nf">test_scores_in_categories</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">expected_categories</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">[(</span><span class="n">score</span><span class="p">,</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">fun</span><span class="p">)</span> <span class="ow">in</span> <span class="n">scores_in_categories</span><span class="p">(</span><span class="n">dice</span><span class="p">)]</span> <span class="o">==</span> <span class="n">expected_categories</span>
</pre></div>
</div>
<section id="parametrize-all-test-in-module">
<h3>parametrize all test in module<a class="headerlink" href="#parametrize-all-test-in-module" title="Link to this heading">¶</a></h3>
<p>To parametrize all tests in a module, you can assign to the pytestmark global variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;n,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>

<span class="k">class</span> <span class="nc">TestClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>

    <span class="k">def</span> <span class="nf">test_weird_simple_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
</section>
<section id="mark-individual-test-instances-within-parametrize">
<h3>mark individual test instances within parametrize<a class="headerlink" href="#mark-individual-test-instances-within-parametrize" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span>
    <span class="p">[(</span><span class="s2">&quot;3+5&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2+4&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;6*9&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
</section>
<section id="stacking-parametrize-decorators">
<h3>stacking parametrize decorators<a class="headerlink" href="#stacking-parametrize-decorators" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<section id="test-doubles">
<h2>test doubles<a class="headerlink" href="#test-doubles" title="Link to this heading">¶</a></h2>
<section id="stubs">
<h3>stubs<a class="headerlink" href="#stubs" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>eg replace a remote sensor over network to measure tire pressure</p></li>
<li><p>simple strict control, no behaviour or logic is replaced</p></li>
<li><p>each test you setup needs a hard coded response</p></li>
</ul>
<p>make sensor object optional in initializer, so test double can be passed
otherwise just call real sensor</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sensor</span> <span class="kn">import</span> <span class="n">Sensor</span>


<span class="k">class</span> <span class="nc">Alarm</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_low_pressure_threshold</span> <span class="o">=</span> <span class="mf">17.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_high_pressure_threshold</span> <span class="o">=</span> <span class="mf">21.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sensor</span> <span class="o">=</span> <span class="n">sensor</span> <span class="ow">or</span> <span class="n">Sensor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_alarm_on</span> <span class="o">=</span> <span class="kc">False</span>

<span class="o">--</span>

<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span>

<span class="kn">from</span> <span class="nn">alarm</span> <span class="kn">import</span> <span class="n">Alarm</span>
<span class="kn">from</span> <span class="nn">sensor</span> <span class="kn">import</span> <span class="n">Sensor</span>


<span class="k">def</span> <span class="nf">test_alarm_is_off_by_default</span><span class="p">():</span>
    <span class="n">alarm</span> <span class="o">=</span> <span class="n">Alarm</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">alarm</span><span class="o">.</span><span class="n">is_alarm_on</span>

<span class="c1"># our stub</span>
<span class="k">class</span> <span class="nc">StubSensor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sample_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">17.0</span>


<span class="k">def</span> <span class="nf">test_alarm_is_on_at_lower_threshold</span><span class="p">():</span>
    <span class="n">alarm</span> <span class="o">=</span> <span class="n">Alarm</span><span class="p">(</span><span class="n">StubSensor</span><span class="p">())</span>
    <span class="n">alarm</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">alarm</span><span class="o">.</span><span class="n">is_alarm_on</span>


<span class="k">def</span> <span class="nf">test_alarm_is_on_at_higher_threshold</span><span class="p">():</span>
    <span class="n">stub</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">Sensor</span><span class="p">)</span>   <span class="c1"># these 2 lines are same as StubSensor class</span>
    <span class="n">stub</span><span class="o">.</span><span class="n">sample_pressure</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mf">21.0</span>
    <span class="n">alarm</span> <span class="o">=</span> <span class="n">Alarm</span><span class="p">(</span><span class="n">stub</span><span class="p">)</span>
    <span class="n">alarm</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">alarm</span><span class="o">.</span><span class="n">is_alarm_on</span>
</pre></div>
</div>
</section>
<section id="fakes">
<h3>fakes<a class="headerlink" href="#fakes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>has an implementation with logic &amp; behaviour but is unsuitable for production:</p>
<ul>
<li><p>replace file operations with a StringIO collaborator</p></li>
<li><p>replace real DB with in-memory database</p></li>
<li><p>replace webserver with light-weight web server</p></li>
</ul>
</li>
</ul>
<section id="stringio">
<h4>StringIO<a class="headerlink" href="#stringio" title="Link to this heading">¶</a></h4>
<p>eg. because we can’t wait testing some really big file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">html_pages</span> <span class="kn">import</span> <span class="n">HtmlPagesConverter</span>


<span class="k">def</span> <span class="nf">test_convert_second_page</span><span class="p">():</span>
    <span class="n">fake_file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">page one</span>
<span class="s2">PAGE_BREAK</span>
<span class="s2">page two</span>
<span class="s2">PAGE_BREAK</span>
<span class="s2">page three</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">converter</span> <span class="o">=</span> <span class="n">HtmlPagesConverter</span><span class="p">(</span><span class="n">fake_file</span><span class="p">)</span>
    <span class="n">converted_text</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">get_html_page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">converted_text</span> <span class="o">==</span> <span class="s2">&quot;page two&lt;br /&gt;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="dummies">
<h3>dummies<a class="headerlink" href="#dummies" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>use of None or an empty collection, shouldn’t be used</p></li>
</ul>
</section>
<section id="spies">
<h3>spies<a class="headerlink" href="#spies" title="Link to this heading">¶</a></h3>
<p><strong>spy records method calls it receives, so you can check correctness</strong>
<strong>spy raises error afterwards in the assert</strong>
(mock will immediately raise one)</p>
<ul class="simple">
<li><p>makes assertions on what happens, it can fail, a stub won’t</p>
<ol class="arabic simple">
<li><p>assert a return value or an exception</p></li>
<li><p>test State change (API query)</p></li>
<li><p>check function/method got called</p></li>
</ol>
</li>
</ul>
<p>eg using <code class="docutils literal notranslate"><span class="pre">Mock.assert_has_calls(expected_calls)</span></code></p>
<section id="manual-spy">
<h4>manual spy<a class="headerlink" href="#manual-spy" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">call</span>

<span class="kn">from</span> <span class="nn">discounts</span> <span class="kn">import</span> <span class="n">DiscountManager</span>
<span class="kn">from</span> <span class="nn">model_objects</span> <span class="kn">import</span> <span class="n">DiscountData</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">SpyNotifier</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notified_users</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># don&#39;t send any messages from the unit test, record which users are notified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notified_users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_discount_for_users_with_spy</span><span class="p">():</span>
    <span class="n">notifier</span> <span class="o">=</span> <span class="n">SpyNotifier</span><span class="p">()</span>
    <span class="n">discount_manager</span> <span class="o">=</span> <span class="n">DiscountManager</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;headphones&quot;</span><span class="p">)</span>
    <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">discount_details</span> <span class="o">=</span> <span class="n">DiscountData</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">% o</span><span class="s2">ff&quot;</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">User</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">]),</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">])]</span>

    <span class="n">discount_manager</span><span class="o">.</span><span class="n">create_discount</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">discount_details</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">==</span> <span class="p">[</span><span class="n">discount_details</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">notifier</span><span class="o">.</span><span class="n">notified_users</span>
    <span class="k">assert</span> <span class="n">users</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">notifier</span><span class="o">.</span><span class="n">notified_users</span>
</pre></div>
</div>
</section>
<section id="using-unittest-mock-spy">
<h4>using unittest.mock spy<a class="headerlink" href="#using-unittest-mock-spy" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_discount_for_users_with_mocking_framework_spy</span><span class="p">():</span>
    <span class="n">notifier</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">discount_manager</span> <span class="o">=</span> <span class="n">DiscountManager</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;headphones&quot;</span><span class="p">)</span>
    <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">discount_details</span> <span class="o">=</span> <span class="n">DiscountData</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">% o</span><span class="s2">ff&quot;</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">User</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">]),</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">])]</span>

    <span class="n">discount_manager</span><span class="o">.</span><span class="n">create_discount</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">discount_details</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">==</span> <span class="p">[</span><span class="n">discount_details</span><span class="p">]</span>
    <span class="n">expected_calls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">call</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;You may be interested in a discount on this product! </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">call</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;You may be interested in a discount on this product! </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">notifier</span><span class="o">.</span><span class="n">notify</span><span class="o">.</span><span class="n">assert_has_calls</span><span class="p">(</span><span class="n">expected_calls</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="mocks">
<h3>mocks<a class="headerlink" href="#mocks" title="Link to this heading">¶</a></h3>
<p><strong>a mock fails earlier in the test than a spy</strong></p>
<ul class="simple">
<li><p>told in advance what methods will be called with what arguments</p></li>
<li><p>will raise error right away if call expectations aren’t met</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MockNotifier</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_user_notifications</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># don&#39;t send any messages from the unit test, check all notifications are expected</span>
        <span class="n">expected_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_user_notifications</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="n">expected_user</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got notification message for unexpected user </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, was expecting </span><span class="si">{</span><span class="n">expected_user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> instead&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expect_notification_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_user_notifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_discount_for_users_with_mock</span><span class="p">():</span>
    <span class="n">notifier</span> <span class="o">=</span> <span class="n">MockNotifier</span><span class="p">()</span>
    <span class="n">discount_manager</span> <span class="o">=</span> <span class="n">DiscountManager</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;headphones&quot;</span><span class="p">)</span>
    <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">discount_details</span> <span class="o">=</span> <span class="n">DiscountData</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">% o</span><span class="s2">ff&quot;</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">User</span><span class="p">(</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">]),</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">product</span><span class="p">])]</span>
    <span class="n">notifier</span><span class="o">.</span><span class="n">expect_notification_to</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">notifier</span><span class="o">.</span><span class="n">expect_notification_to</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">discount_manager</span><span class="o">.</span><span class="n">create_discount</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">discount_details</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">product</span><span class="o">.</span><span class="n">discounts</span> <span class="o">==</span> <span class="p">[</span><span class="n">discount_details</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="approval-tests">
<h2>approval tests<a class="headerlink" href="#approval-tests" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>approvaltests
pip<span class="w"> </span>install<span class="w"> </span>pytest-approvaltests
pytest<span class="w"> </span>--approvaltests-use-reporter<span class="o">=</span><span class="s1">&#39;PythonNative&#39;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approvaltests.approvals</span> <span class="kn">import</span> <span class="n">verify</span>


<span class="k">def</span> <span class="nf">test_simple</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Hello ApprovalTests&quot;</span>
    <span class="n">verify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>pytest runner configuration:</p>
<p>Additional Arguments: <code class="docutils literal notranslate"><span class="pre">--approvaltests-use-reporter'PythonNative'</span></code></p>
<p>create approval files in subdir through config file
approvals_config.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;subdirectory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;approved_files&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="verify-string">
<h3>verify string<a class="headerlink" href="#verify-string" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">approvaltests</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">model_objects</span> <span class="kn">import</span> <span class="n">SpecialOfferType</span>
<span class="kn">from</span> <span class="nn">receipt_printer</span> <span class="kn">import</span> <span class="n">ReceiptPrinter</span>


<span class="k">def</span> <span class="nf">test_no_discount</span><span class="p">(</span><span class="n">teller</span><span class="p">,</span> <span class="n">cart</span><span class="p">,</span> <span class="n">toothbrush</span><span class="p">,</span> <span class="n">apples</span><span class="p">):</span>
    <span class="n">teller</span><span class="o">.</span><span class="n">add_special_offer</span><span class="p">(</span><span class="n">SpecialOfferType</span><span class="o">.</span><span class="n">TEN_PERCENT_DISCOUNT</span><span class="p">,</span> <span class="n">toothbrush</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
    <span class="n">cart</span><span class="o">.</span><span class="n">add_item_quantity</span><span class="p">(</span><span class="n">apples</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>

    <span class="n">receipt</span> <span class="o">=</span> <span class="n">teller</span><span class="o">.</span><span class="n">checks_out_articles_from</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>

    <span class="n">approvaltests</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">ReceiptPrinter</span><span class="p">()</span><span class="o">.</span><span class="n">print_receipt</span><span class="p">(</span><span class="n">receipt</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_ten_percent_discount</span><span class="p">(</span><span class="n">teller</span><span class="p">,</span> <span class="n">cart</span><span class="p">,</span> <span class="n">toothbrush</span><span class="p">):</span>
    <span class="n">teller</span><span class="o">.</span><span class="n">add_special_offer</span><span class="p">(</span><span class="n">SpecialOfferType</span><span class="o">.</span><span class="n">TEN_PERCENT_DISCOUNT</span><span class="p">,</span> <span class="n">toothbrush</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
    <span class="n">cart</span><span class="o">.</span><span class="n">add_item_quantity</span><span class="p">(</span><span class="n">toothbrush</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">receipt</span> <span class="o">=</span> <span class="n">teller</span><span class="o">.</span><span class="n">checks_out_articles_from</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>

    <span class="n">approvaltests</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">ReceiptPrinter</span><span class="p">()</span><span class="o">.</span><span class="n">print_receipt</span><span class="p">(</span><span class="n">receipt</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="best-covering-pairs">
<h3>best covering pairs<a class="headerlink" href="#best-covering-pairs" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">approvaltests.verify_best_covering_pairs()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">import</span> <span class="nn">approvaltests</span>

<span class="kn">from</span> <span class="nn">gilded_rose</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">GildedRose</span>


<span class="k">def</span> <span class="nf">print_item</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Item(</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, sell_in=</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">sell_in</span><span class="si">}</span><span class="s2">, quality=</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">quality</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="k">def</span> <span class="nf">update_quality_printer</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="n">print_item</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">test_update_quality</span><span class="p">():</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;Cottage Cheese&quot;</span><span class="p">,</span> <span class="s2">&quot;Backstage tickets&quot;</span><span class="p">,</span> <span class="s2">&quot;Magic Wand&quot;</span><span class="p">]</span>
    <span class="n">sell_ins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
    <span class="n">qualitys</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>

    <span class="n">approvaltests</span><span class="o">.</span><span class="n">verify_best_covering_pairs</span><span class="p">(</span>
        <span class="n">update_quality_for_item</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">names</span><span class="p">,</span>
            <span class="n">sell_ins</span><span class="p">,</span>
            <span class="n">qualitys</span>
        <span class="p">],</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">update_quality_printer</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">update_quality_for_item</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sell_in</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sell_in</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="n">gilded_rose</span> <span class="o">=</span> <span class="n">GildedRose</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">gilded_rose</span><span class="o">.</span><span class="n">update_quality</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">item</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Testing</span> <span class="n">an</span> <span class="n">optimized</span> <span class="mi">30</span><span class="o">/</span><span class="mi">120</span> <span class="n">scenarios</span><span class="p">:</span>

<span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">Item</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">sell_in</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;Cottage Cheese&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">Item</span><span class="p">(</span><span class="n">Cottage</span> <span class="n">Cheese</span><span class="p">,</span> <span class="n">sell_in</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;Backstage tickets&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">Item</span><span class="p">(</span><span class="n">Backstage</span> <span class="n">tickets</span><span class="p">,</span> <span class="n">sell_in</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;Magic Wand&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">Item</span><span class="p">(</span><span class="n">Magic</span> <span class="n">Wand</span><span class="p">,</span> <span class="n">sell_in</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="more-advanced-combination-approvals">
<h3>more advanced combination approvals<a class="headerlink" href="#more-advanced-combination-approvals" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/approvals/ApprovalTests.Python/blob/main/approvaltests/combination_approvals.py">more combination approval code</a></p>
</section>
</section>
<section id="coverage">
<h2>coverage<a class="headerlink" href="#coverage" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://coverage.readthedocs.io/">coverage docs</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage<span class="w"> </span><span class="nb">help</span>
coverage<span class="w"> </span><span class="nb">help</span><span class="w"> </span>run
coverage<span class="w"> </span>run<span class="w"> </span>--help
</pre></div>
</div>
<ul class="simple">
<li><p>run – Run a Python program and collect execution data.</p></li>
<li><p>combine – Combine together a number of data files.</p></li>
<li><p>erase – Erase previously collected coverage data.</p></li>
<li><p>report – Report coverage results.</p></li>
<li><p>html – Produce annotated HTML listings with coverage results.</p></li>
<li><p>xml – Produce an XML report with coverage results.</p></li>
<li><p>json – Produce a JSON report with coverage results.</p></li>
<li><p>lcov – Produce an LCOV report with coverage results.</p></li>
<li><p>annotate – Annotate source files with coverage results.</p></li>
<li><p>debug – Get diagnostic information.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>coverage

coverage<span class="w"> </span>run<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>arg1<span class="w"> </span>arg2<span class="w"> </span>arg3

$<span class="w"> </span>coverage<span class="w"> </span>report<span class="w"> </span>-m
Name<span class="w">                      </span>Stmts<span class="w">   </span>Miss<span class="w">  </span>Cover<span class="w">   </span>Missing
-------------------------------------------------------
my_program.py<span class="w">                </span><span class="m">20</span><span class="w">      </span><span class="m">4</span><span class="w">    </span><span class="m">80</span>%<span class="w">   </span><span class="m">33</span>-35,<span class="w"> </span><span class="m">39</span>
my_other_module.py<span class="w">           </span><span class="m">56</span><span class="w">      </span><span class="m">6</span><span class="w">    </span><span class="m">89</span>%<span class="w">   </span><span class="m">17</span>-23
-------------------------------------------------------
TOTAL<span class="w">                        </span><span class="m">76</span><span class="w">     </span><span class="m">10</span><span class="w">    </span><span class="m">87</span>%


<span class="c1"># to view lines in html</span>
$<span class="w"> </span>coverage<span class="w"> </span>html


<span class="c1"># to measure branch coverage:</span>
coverage<span class="w"> </span>run<span class="w"> </span>--branch<span class="w"> </span>myprog.py
</pre></div>
</div>
<section id="exclude-branches">
<h3>exclude branches<a class="headerlink" href="#exclude-branches" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">only_one_choice</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">blah1</span><span class="p">()</span>
        <span class="n">blah2</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># x is always true.</span>
        <span class="n">blah3</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pytest-runner-cov-plugin">
<h3>pytest runner cov plugin<a class="headerlink" href="#pytest-runner-cov-plugin" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://pytest-cov.readthedocs.io/en/latest/">pytest-cov plugin docs</a></p>
</section>
</section>
<section id="monkeypatching">
<h2>monkeypatching<a class="headerlink" href="#monkeypatching" title="Link to this heading">¶</a></h2>
<p>dynamically change an attribute or some code at runtime</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># scorer.py</span>
<span class="k">def</span> <span class="nf">lookup_weather</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">location</span> <span class="ow">or</span> <span class="p">(</span><span class="mf">59.3293</span><span class="p">,</span> <span class="mf">18.0686</span><span class="p">)</span>  <span class="c1"># Stockholm default</span>
    <span class="n">days_forward</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;days_forward&quot;</span><span class="p">:</span> <span class="n">days_forward</span><span class="p">}</span>
    <span class="n">weather_app</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:3005&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">weather_app</span> <span class="o">+</span> <span class="s2">&quot;/forecast&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Weather service unavailable&quot;</span><span class="p">)</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">][</span><span class="s2">&quot;main&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sunny&quot;</span><span class="p">)</span>

<span class="o">---</span>
<span class="c1"># test_scorer.py</span>
<span class="c1"># replace a function in the request module</span>
<span class="k">class</span> <span class="nc">StubWeatherResponse</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;Sunny&quot;</span><span class="p">}}</span>

<span class="k">def</span> <span class="nf">test_lookup_weather_location</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">stub_requests_get</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">StubWeatherResponse</span><span class="p">()</span>

    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">stub_request_get</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">scorer</span><span class="o">.</span><span class="n">lookup_weather</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span>  <span class="c1"># now request in lookup_weather going through stub</span>
</pre></div>
</div>
</section>
<section id="vcrpy-pytest-recording">
<h2>VCRpy &amp; pytest-recording<a class="headerlink" href="#vcrpy-pytest-recording" title="Link to this heading">¶</a></h2>
<p>record request from api to a cassette</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libyaml</span><span class="o">-</span><span class="n">dev</span>

<span class="n">pip3</span> <span class="n">install</span> <span class="n">vcrpy</span>

<span class="c1"># test</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;from yaml import CLoader&#39;</span>

<span class="c1"># Rebuild pyyaml with libyaml</span>
<span class="n">pip3</span> <span class="n">uninstall</span> <span class="n">pyyaml</span>
<span class="n">pip3</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="nb">dir</span> <span class="n">install</span> <span class="n">pyyaml</span>
</pre></div>
</div>
<p><a class="reference external" href="https://vcrpy.readthedocs.io/en/latest/">VCR docs</a></p>
<p>VCR.py simplifies and speeds up tests that make HTTP requests. The first time you run code that is inside a VCR.py context manager or decorated function, VCR.py records all HTTP interactions that take place through the libraries it supports and serializes and writes them to a flat file (in yaml format by default). This flat file is called a cassette. When the relevant piece of code is executed again, VCR.py will read the serialized requests and responses from the aforementioned cassette file, and intercept any HTTP requests that it recognizes from the original test run and return the responses that corresponded to those requests. This means that the requests will not actually result in HTTP traffic, which confers several benefits including:</p>
<p>The ability to work offline
Completely deterministic tests
Increased test execution speed
If the server you are testing against ever changes its API, all you need to do is delete your existing cassette files, and run your tests again. VCR.py will detect the absence of a cassette file and once again record all HTTP interactions, which will update them to correspond to the new API</p>
<section id="usage-with-pytest">
<h3>usage with pytest<a class="headerlink" href="#usage-with-pytest" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/kiwicom/pytest-recording">pytest-recording</a>
<a class="reference external" href="https://github.com/ktosiek/pytest-vcr">pytest-vcr</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run/debug configuration in pycharm, add record mode flag</span>

<span class="c1"># Additional Arguments:</span>
<span class="o">--</span><span class="n">approvaltests</span><span class="o">-</span><span class="n">use</span><span class="o">-</span><span class="n">reporter</span><span class="o">=</span><span class="s1">&#39;PythonNative&#39;</span> <span class="o">--</span><span class="n">record</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">once</span>
<span class="c1"># this will record them the first time and then replay that</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># scorer.py</span>
<span class="k">def</span> <span class="nf">lookup_weather</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">location</span> <span class="ow">or</span> <span class="p">(</span><span class="mf">59.3293</span><span class="p">,</span> <span class="mf">18.0686</span><span class="p">)</span>  <span class="c1"># Stockholm default</span>
    <span class="n">days_forward</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;days_forward&quot;</span><span class="p">:</span> <span class="n">days_forward</span><span class="p">}</span>
    <span class="n">weather_app</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:3005&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">weather_app</span> <span class="o">+</span> <span class="s2">&quot;/forecast&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Weather service unavailable&quot;</span><span class="p">)</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">][</span><span class="s2">&quot;main&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sunny&quot;</span><span class="p">)</span>

<span class="o">---</span>
<span class="c1"># test-scorer.py</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">vcr</span>
<span class="k">def</span> <span class="nf">test_lookup_weather_not_sunny</span><span class="p">():</span>
    <span class="n">location_bxl</span> <span class="o">=</span> <span class="p">(</span><span class="mf">50.8505</span><span class="p">,</span> <span class="mf">4.3488</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">scorer</span><span class="o">.</span><span class="n">lookup_weather</span><span class="p">(</span><span class="n">location_bxl</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># test_lookup_weather_not_sunny.yaml</span>

<span class="n">interactions</span><span class="p">:</span>
<span class="o">-</span> <span class="n">request</span><span class="p">:</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">null</span>
    <span class="n">headers</span><span class="p">:</span>
      <span class="n">Accept</span><span class="p">:</span>
      <span class="o">-</span> <span class="s1">&#39;*/*&#39;</span>
      <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span>
      <span class="n">Connection</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
      <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">python</span><span class="o">-</span><span class="n">requests</span><span class="o">/</span><span class="mf">2.30.0</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">GET</span>
    <span class="n">uri</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">3005</span><span class="o">/</span><span class="n">forecast</span><span class="err">?</span><span class="n">latitude</span><span class="o">=</span><span class="mf">50.8505</span><span class="o">&amp;</span><span class="n">longitude</span><span class="o">=</span><span class="mf">4.3488</span><span class="o">&amp;</span><span class="n">days_forward</span><span class="o">=</span><span class="mi">0</span>
  <span class="n">response</span><span class="p">:</span>
    <span class="n">body</span><span class="p">:</span>
      <span class="n">string</span><span class="p">:</span> <span class="s1">&#39;{&quot;days_forward&quot;:0.0,&quot;latitude&quot;:50.8505,&quot;longitude&quot;:4.3488,&quot;todays_date&quot;:&quot;2023-05-17T15:36:53.191147&quot;,&quot;weather&quot;:{&quot;clouds&quot;:{&quot;afternoon&quot;:100,&quot;evening&quot;:75,&quot;morning&quot;:100,&quot;pre_dawn&quot;:50},&quot;description&quot;:&quot;moderate</span>
        <span class="n">snow</span><span class="s2">&quot;,&quot;</span><span class="n">main</span><span class="s2">&quot;:&quot;</span><span class="n">Snow</span><span class="s2">&quot;,&quot;</span><span class="n">precipitation</span><span class="s2">&quot;:{&quot;</span><span class="n">snow</span><span class="s2">&quot;:{&quot;</span><span class="n">afternoon</span><span class="s2">&quot;:2.2,&quot;</span><span class="n">evening</span><span class="s2">&quot;:0.0,&quot;</span><span class="n">morning</span><span class="s2">&quot;:1.0,&quot;</span><span class="n">pre_dawn</span><span class="s2">&quot;:0.5,&quot;</span><span class="n">total</span><span class="s2">&quot;:3.7}},&quot;</span><span class="n">temperature</span><span class="s2">&quot;:{&quot;</span><span class="n">average_daytime</span><span class="s2">&quot;:&quot;</span><span class="mi">5</span><span class="s2">&quot;,&quot;</span><span class="n">maximum</span><span class="s2">&quot;:&quot;</span><span class="mi">8</span><span class="s2">&quot;,&quot;</span><span class="n">minimum</span><span class="s2">&quot;:&quot;</span><span class="mi">3</span><span class="s2">&quot;},&quot;</span><span class="n">visibility</span><span class="s2">&quot;:30,&quot;</span><span class="n">wind</span><span class="s2">&quot;:{&quot;</span><span class="n">direction</span><span class="s2">&quot;:244,&quot;</span><span class="n">gust</span><span class="s2">&quot;:1.18,&quot;</span><span class="n">speed</span><span class="s2">&quot;:0.62}}}</span>

        <span class="s1">&#39;</span>
    <span class="n">headers</span><span class="p">:</span>
      <span class="n">Connection</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">close</span>
      <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span>
      <span class="o">-</span> <span class="s1">&#39;459&#39;</span>
      <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
      <span class="n">Date</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">22</span> <span class="n">November</span> <span class="mi">2023</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">53</span> <span class="n">GMT</span>
      <span class="n">Server</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">2.3.4</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.10</span>
    <span class="n">status</span><span class="p">:</span>
      <span class="n">code</span><span class="p">:</span> <span class="mi">200</span>
      <span class="n">message</span><span class="p">:</span> <span class="n">OK</span>
<span class="n">version</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../sphinx.html">sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/awk.html">awk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/find.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/scripting.html">scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html">line selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#append-insert-delete-actions">append insert delete actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#substitute">substitute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/sed.html#grouping-expressions">grouping expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="assert.html">assert python</a></li>
<li class="toctree-l1"><a class="reference internal" href="assert.html#assert-pandas">assert pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataclass.html">dataclasses</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_ops.html">glob</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional.html">functional programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html">fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#syncronize-iterations-over-2-iterable-series">syncronize iterations over 2 iterable series</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#eg-two-series-of-temperature-data">eg two  series of temperature data</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#bind-them-in-pairs-of-corresponding-readings">bind them in pairs of corresponding readings</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#zip-yields-tuples-when-iterated">zip yields tuples when iterated</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-can-take-advantage-of-this-with-tuple-unpacking-in-the-for-loop">we can take advantage of this with tuple unpacking in the for loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#now-we-want-one-long-temperature-series-for-sunday-monday-and-thuesday">now we want one long temperature series for sunday monday and thuesday</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-can-then-lazily-concatenate-iterables-using-itertools-chain">we can then lazily concatenate iterables using itertools chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#this-is-different-from-simply-concatenating-3-lists-into-a-new-list">this is different from simply concatenating 3 lists into a new list</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#we-have-no-memory-impact-of-data-duplication">we have no memory impact of data duplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html#following-shows-generator-functions-generator-expressions-predicate-functions-and-for-loops">following shows generator functions, generator expressions, predicate functions and for loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="generator.html">generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">code library</a></li>
<li class="toctree-l1"><a class="reference internal" href="regex.html">regex</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pytest</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pytest-ini">pytest.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skip-slow">skip &amp; slow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fixtures">fixtures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#capsys">capsys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conftest-py">conftest.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assertions-on-expected-exceptions">assertions on expected exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametrize">parametrize</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parametrize-all-test-in-module">parametrize all test in module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mark-individual-test-instances-within-parametrize">mark individual test instances within parametrize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stacking-parametrize-decorators">stacking parametrize decorators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#test-doubles">test doubles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stubs">stubs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fakes">fakes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stringio">StringIO</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dummies">dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spies">spies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#manual-spy">manual spy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-unittest-mock-spy">using unittest.mock spy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mocks">mocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#approval-tests">approval tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verify-string">verify string</a></li>
<li class="toctree-l3"><a class="reference internal" href="#best-covering-pairs">best covering pairs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-advanced-combination-approvals">more advanced combination approvals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#coverage">coverage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exclude-branches">exclude branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytest-runner-cov-plugin">pytest runner cov plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#monkeypatching">monkeypatching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vcrpy-pytest-recording">VCRpy &amp; pytest-recording</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage-with-pytest">usage with pytest</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="regex.html" title="regex"
             >previous</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">PowrUsr Docs alpha documentation</a> &#187;
              
          </li>
        <li class="nav-item nav-item-this"><a href="">pytest</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" id="search-box" />
          <input type="submit" value="Go" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; Copyright 2023, PowrUsr.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    Last updated on 2023-12-09.
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>

  </body>
</html>