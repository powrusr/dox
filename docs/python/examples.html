<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>code library &#8212; PowrUsr Docs alpha documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=aa5eeaf2" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=b20cc3f5" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c6eb1e0f" />
    
    <script src="../_static/documentation_options.js?v=1f169f65"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="vim" href="../vim/index.html" />
    <link rel="prev" title="typing" href="typing.html" /><link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Logo"/>
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" />
                <input type="submit" value="Go"/>
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label>
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">main</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ai/index.html">ai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx.html">sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/index.html">bash</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="assert.html">assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="asyncio.html">asyncio</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">core</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataclass.html">dataclasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataclass.html#attrs">Attrs</a></li>
<li class="toctree-l2"><a class="reference internal" href="designpatterns.html">design patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_ops.html">glob</a></li>
<li class="toctree-l2"><a class="reference internal" href="functional.html">functional programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="fundamentals.html">fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="pandas.html">pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyenv.html">pyenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex.html">regex</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html">typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#annotated-typing">annotated typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#pydantic">pydantic</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">code library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vim/index.html">vim</a></li>
</ul>

  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">code library</a><ul>
<li><a class="reference internal" href="#parametrize">parametrize</a><ul>
<li><a class="reference internal" href="#pydantic">pydantic</a></li>
<li><a class="reference internal" href="#custom-parametrization">custom parametrization</a></li>
<li><a class="reference internal" href="#main-test">main test</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </nav>
    </div>
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../vim/index.html" title="vim"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="typing.html" title="typing"
             accesskey="P">previous</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">PowrUsr Docs alpha documentation</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">python</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">code library</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" id="search-box" />
          <input type="submit" value="Go" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="code-library">
<h1>code library<a class="headerlink" href="#code-library" title="Link to this heading">¶</a></h1>
<section id="parametrize">
<h2>parametrize<a class="headerlink" href="#parametrize" title="Link to this heading">¶</a></h2>
<section id="pydantic">
<h3>pydantic<a class="headerlink" href="#pydantic" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># rest.py</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span><span class="p">,</span> <span class="n">Flag</span><span class="p">,</span> <span class="n">StrEnum</span><span class="p">,</span> <span class="n">verify</span><span class="p">,</span> <span class="n">UNIQUE</span><span class="p">,</span> <span class="n">CONTINUOUS</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="n">Endpoint</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^\/api\/v2\/\w+\/\w+$&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># PartyId = Annotated[str, StringConstraints(min_length=64, max_length=64)]</span>
<span class="n">PartyId</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;[a-fA-F0-9]</span><span class="si">{64}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="n">AssetId</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;[a-fA-F0-9]</span><span class="si">{64}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="c1"># PartyId = Annotated[str, StringConstraints(pattern=r&#39;[a-fA-F0-9]{64}&#39;]</span>
<span class="c1"># PartyId = Annotated[str, Field(min_length=64, max_length=64, pattern=r&#39;[a-fA-F0-9]{64}&#39;, validate_default=True)]</span>
<span class="n">BaseModel</span><span class="o">.</span><span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate_assignment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># from abc import ABC</span>


<span class="nd">@verify</span><span class="p">(</span><span class="n">UNIQUE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AccountType</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="n">ACCOUNT_TYPE_UNSPECIFIED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># default value</span>
    <span class="n">ACCOUNT_TYPE_INSURANCE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># contain insurance pool funds for a market</span>
    <span class="n">ACCOUNT_TYPE_SETTLEMENT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># exist only during settlement or mark-to-market</span>
    <span class="n">ACCOUNT_TYPE_MARGIN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># required initial margin is allocated to each market from user&#39;s general account. Collateral in the margin account can&#39;t be withdrawn or used as margin on another market until it is released back to the general account</span>
    <span class="n">ACCOUNT_TYPE_GENERAL</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># contain the collateral for a party that is not otherwise allocated. A party will have multiple general accounts, one for each asset they want to trade with. General accounts are where funds are initially deposited or withdrawn from, it is also the account where funds are taken to fulfil fees and initial margin requirements</span>
    <span class="n">ACCOUNT_TYPE_FEES_INFRASTRUCTURE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># contain fees earned by providing infrastructure on Vega</span>
    <span class="n">ACCOUNT_TYPE_FEES_LIQUIDITY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># contain fees earned by providing liquidity on Vega markets</span>
    <span class="n">ACCOUNT_TYPE_FEES_MAKER</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># hold fees earned by placing orders that sit on the book and are then matched with an incoming order to create a trade - These fees reward parties who provide the best priced liquidity that actually allows trading to take place</span>
    <span class="n">ACCOUNT_TYPE_BOND</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># created to maintain liquidity providers funds commitments</span>
    <span class="n">ACCOUNT_TYPE_EXTERNAL</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># represents an external source (deposit/withdrawal)</span>
    <span class="n">ACCOUNT_TYPE_GLOBAL_INSURANCE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># global insurance account for the asset</span>
    <span class="n">ACCOUNT_TYPE_GLOBAL_REWARD</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># global reward account for the asset</span>
    <span class="n">ACCOUNT_TYPE_PENDING_TRANSFERS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset account used to store pending transfers (if any)</span>
    <span class="n">ACCOUNT_TYPE_REWARD_MAKER_PAID_FEES</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset reward account for fees paid to makers</span>
    <span class="n">ACCOUNT_TYPE_REWARD_MAKER_RECEIVED_FEES</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset reward account for fees received by makers</span>
    <span class="n">ACCOUNT_TYPE_REWARD_LP_RECEIVED_FEES</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset reward account for fees received by liquidity providers</span>
    <span class="n">ACCOUNT_TYPE_REWARD_MARKET_PROPOSERS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset reward account for market proposers when the market goes above some trading threshold</span>
    <span class="n">ACCOUNT_TYPE_HOLDING</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset account for holding in-flight unfilled orders&#39; funds</span>
    <span class="n">ACCOUNT_TYPE_LP_LIQUIDITY_FEES</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># network controlled liquidity provider&#39;s account, per market, to hold accrued liquidity fees</span>
    <span class="n">ACCOUNT_TYPE_LIQUIDITY_FEES_BONUS_DISTRIBUTION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># network controlled liquidity fees bonus distribution account, per market</span>
    <span class="n">ACCOUNT_TYPE_NETWORK_TREASURY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># network controlled treasury</span>
    <span class="n">ACCOUNT_TYPE_VESTING_REWARDS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># account holding user&#39;s rewards for the vesting period</span>
    <span class="n">ACCOUNT_TYPE_VESTED_REWARDS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># account holding user&#39;s rewards after the vesting period</span>
    <span class="n">ACCOUNT_TYPE_REWARD_AVERAGE_POSITION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset market reward account given for average position</span>
    <span class="n">ACCOUNT_TYPE_REWARD_RELATIVE_RETURN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset market reward account given for relative return</span>
    <span class="n">ACCOUNT_TYPE_REWARD_RETURN_VOLATILITY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset market reward account given for return volatility</span>
    <span class="n">ACCOUNT_TYPE_REWARD_VALIDATOR_RANKING</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset market reward account given to validators by their ranking</span>
    <span class="n">ACCOUNT_TYPE_PENDING_FEE_REFERRAL_REWARD</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset account for pending fee referral reward payouts</span>
    <span class="n">ACCOUNT_TYPE_ORDER_MARGIN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># per asset market account for party in isolated margin mode</span>


<span class="nd">@verify</span><span class="p">(</span><span class="n">UNIQUE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ProposalState</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Proposal states&quot;&quot;&quot;</span>
    <span class="n">STATE_UNSPECIFIED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Default value, always invalid</span>
    <span class="n">STATE_FAILED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal enactment has failed - even though proposal has passed, its execution could not be performed</span>
    <span class="n">STATE_OPEN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal is open for voting</span>
    <span class="n">STATE_PASSED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal has gained enough support to be executed</span>
    <span class="n">STATE_REJECTED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal wasn&#39;t accepted (proposal terms failed validation due to wrong configuration or failing to meet network requirements)</span>
    <span class="n">STATE_DECLINED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal didn&#39;t get enough votes (either failing to gain required participation or majority level)</span>
    <span class="n">STATE_ENACTED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Proposal enacted</span>
    <span class="n">STATE_WAITING_FOR_NODE_VOTE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Waiting for node validation of the proposal</span>


<span class="nd">@verify</span><span class="p">(</span><span class="n">UNIQUE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ProposalType</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Proposal typings&quot;&quot;&quot;</span>
    <span class="n">TYPE_UNSPECIFIED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Default value, always invalid</span>
    <span class="n">TYPE_ALL</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># List all proposals</span>
    <span class="n">TYPE_NEW_MARKET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># List new market proposals</span>
    <span class="n">TYPE_UPDATE_MARKET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># List update market proposals</span>
    <span class="n">TYPE_NETWORK_PARAMETERS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># List change network parameter proposals</span>
    <span class="n">TYPE_NEW_ASSET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># New asset proposals</span>
    <span class="n">TYPE_NEW_FREE_FORM</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># for creating n ew free form proposal</span>
    <span class="n">TYPE_UPDATE_ASSET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Update asset proposals</span>
    <span class="n">TYPE_NEW_SPOT_MARKET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># New spot market proposals</span>
    <span class="n">TYPE_UPDATE_SPOT_MARKET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Update existing spot market</span>
    <span class="n">TYPE_NEW_TRANSFER</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># New transfer proposal</span>
    <span class="n">TYPE_CANCEL_TRANSFER</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Cancel transfer</span>
    <span class="n">TYPE_UPDATE_MARKET_STATE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Update market state</span>
    <span class="n">TYPE_UPDATE_REFERRAL_PROGRAM</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Update referral program</span>
    <span class="n">TYPE_UPDATE_VOLUME_DISCOUNT_PROGRAM</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Update volume discount program</span>


<span class="k">class</span> <span class="nc">Pagination</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">first</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of records to be returned that sort greater than row identified by cursor supplied in &#39;after&#39;</span>
    <span class="n">after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># If paging forwards, the cursor string for the last row of the previous page</span>
    <span class="n">last</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of records to be returned that sort less than row identified by cursor supplied in &#39;before&#39;</span>
    <span class="n">before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># If paging forwards, the cursor string for the first row of the previous page</span>
    <span class="n">newestFirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Whether to order the results with the newest records first</span>


<span class="k">class</span> <span class="nc">AccountFilter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># pydantic makes a deepcopy of default value []</span>
    <span class="n">assetId</span><span class="p">:</span> <span class="n">AssetId</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Restrict accounts to those holding balances in this asset ID</span>
    <span class="n">partyIds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PartyId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Restrict accounts to those with the given party IDs</span>
    <span class="n">marketIds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Restrict accounts to those connected to the markets in this list. Pass an empty list for no filter.</span>
    <span class="n">accountTypes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AccountType</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Restrict accounts to those connected to any of the types in this list. Pass an empty list for no filter.</span>


<span class="k">class</span> <span class="nc">ParamsAccountBalanceChanges</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">revalidate_instances</span><span class="o">=</span><span class="s1">&#39;never&#39;</span><span class="p">)</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Endpoint</span> <span class="o">=</span> <span class="s2">&quot;/api/v2/balance/changes&quot;</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">AccountFilter</span> <span class="o">=</span> <span class="n">AccountFilter</span><span class="p">()</span>
    <span class="n">pagination</span><span class="p">:</span> <span class="n">Pagination</span> <span class="o">=</span> <span class="n">Pagination</span><span class="p">()</span>  <span class="c1"># returns configurable pagination dict</span>


<span class="k">class</span> <span class="nc">ParamsGovernanceAllProposals</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query a list of all proposals&quot;&quot;&quot;</span>
    <span class="n">proposalState</span><span class="p">:</span> <span class="n">ProposalState</span> <span class="o">=</span> <span class="n">ProposalState</span><span class="o">.</span><span class="n">STATE_UNSPECIFIED</span>
    <span class="n">proposalType</span><span class="p">:</span> <span class="n">ProposalType</span> <span class="o">=</span> <span class="n">ProposalType</span><span class="o">.</span><span class="n">TYPE_UNSPECIFIED</span>
    <span class="n">proposerPartyId</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;[a-fA-F0-9]</span><span class="si">{64}</span><span class="s1">&#39;</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># restrict proposal to those proposed by the given party ID</span>
    <span class="n">proposalReference</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Restrict proposals to those with the given reference</span>


<span class="k">class</span> <span class="nc">RestCall</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Endpoint</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span>  <span class="c1"># https://docs.python.org/3/library/typing.html#annotating-callables</span>
    <span class="n">usePagination</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># use pagination in rest api</span>

</pre></div>
</div>
</section>
<section id="custom-parametrization">
<h3>custom parametrization<a class="headerlink" href="#custom-parametrization" title="Link to this heading">¶</a></h3>
<p>parametrization of dictionary values after doing <code class="docutils literal notranslate"><span class="pre">pydantic.dump_model</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vegavote.typings.custom</span> <span class="kn">import</span> <span class="n">DictSimple</span><span class="p">,</span> <span class="n">DictSimpleList</span><span class="p">,</span> <span class="n">BasicTypes</span><span class="p">,</span> <span class="n">DictItems</span>


<span class="k">def</span> <span class="nf">parametrize_basic</span><span class="p">(</span><span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">DictSimple</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; {&#39;first&#39;: 5} converts to &#39;parent_key.first=5&amp;&#39; &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="c1"># tuple comma is needed!</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">parametrize_list</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BasicTypes</span><span class="p">],</span> <span class="n">glue</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">glue</span><span class="p">:</span>  <span class="c1"># nums=1,2,3&amp;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">,&quot;</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># foreach n in list separate eg: nums=1&amp;nums=2&amp;nums=3&amp;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parametrize_dict</span><span class="p">(</span><span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">built_url</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if value inside the dictionary is another mapping</span>
    <span class="n">dict_inner_value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">dictionary</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># dict values obj is not subscriptable so conversion to tuple</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_inner_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># eg: &quot;filter&quot;: {&#39;partyIds&#39;: [&#39;d30dd1cffe&#39;, &#39;5cb1faaac866&#39;]}</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">dictionary</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># splitting because parent_key needs to be added to both list elements, throw away last split</span>
        <span class="n">parametrized_elements</span> <span class="o">=</span> <span class="n">parametrize_list</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">dict_inner_value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">built_url</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">x</span><span class="si">}{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parametrized_elements</span><span class="p">))</span>
        <span class="c1"># built_url.append(parametrize_dict_inner_list(parent_key, dictionary, sep=sep))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_inner_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># add parent key with dot notation and recursively call this function</span>
        <span class="p">(</span><span class="n">inner_key</span><span class="p">,</span> <span class="n">inner_value</span><span class="p">),</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">built_url</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parametrize_dict</span><span class="p">(</span><span class="n">parent_key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">inner_key</span><span class="p">,</span> <span class="n">inner_value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_inner_value</span><span class="p">,</span> <span class="n">BasicTypes</span><span class="p">):</span>
        <span class="n">built_url</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parametrize_basic</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhandled datastructure value inside dictionary: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dict_inner_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">built_url</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parametrize_on_type</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">DictItems</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">d</span>  <span class="c1"># tuple comma is needed!</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># validate record is a dictionary</span>
        <span class="k">return</span> <span class="n">parametrize_dict</span><span class="p">(</span><span class="n">parent_key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BasicTypes</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">parametrize_list</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;investigate unsupported type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">build_params</span><span class="p">(</span><span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parametrize_on_type</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

</pre></div>
</div>
<p>testing it</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>  <span class="c1"># https://docs.pytest.org/en/7.1.x/getting-started.html</span>
<span class="kn">from</span> <span class="nn">vegavote.typings.custom</span> <span class="kn">import</span> <span class="n">DictSimple</span><span class="p">,</span> <span class="n">DictSimpleList</span>
<span class="kn">from</span> <span class="nn">vegavote</span> <span class="kn">import</span> <span class="n">parametrize</span> <span class="k">as</span> <span class="n">par</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;parent_key, d, sep, expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;filter.first=5&amp;&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_parametrize_basic</span><span class="p">(</span><span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">DictSimple</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">parametrize_basic</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>


<span class="k">def</span> <span class="nf">test_parametrize_list</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">parametrize_list</span><span class="p">(</span><span class="s1">&#39;some_numbers&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">glue</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;some_numbers=1,2,3&amp;&#39;</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">parametrize_list</span><span class="p">(</span><span class="s1">&#39;nums&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">glue</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;nums=1&amp;nums=2&amp;nums=3&amp;&#39;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;parent_key, d_row, sep, expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;partyIds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d30dd1cffe&#39;</span><span class="p">,</span> <span class="s1">&#39;5cb1faaac866&#39;</span><span class="p">]},</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
     <span class="s1">&#39;filter.partyIds=d30dd1cffe&amp;filter.partyIds=5cb1faaac866&amp;&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;recursive&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;partyIds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lol&#39;</span><span class="p">,</span> <span class="s1">&#39;mao&#39;</span><span class="p">]}},</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
     <span class="s1">&#39;recursive.filter.partyIds=lol&amp;recursive.filter.partyIds=mao&amp;&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_parametrize_dict</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">d_row</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">parametrize_dict</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">d_row</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">data_sample_given</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;partyIds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d30dd1cffe&#39;</span><span class="p">,</span> <span class="s1">&#39;5cb1faaac866&#39;</span><span class="p">]},</span>
             <span class="s1">&#39;pagination&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
             <span class="s2">&quot;lol&quot;</span><span class="p">:</span> <span class="s2">&quot;mao&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;nums&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
             <span class="s1">&#39;a_string&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span>
             <span class="s1">&#39;a_dictionary&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lol&#39;</span><span class="p">:</span> <span class="s1">&#39;mao&#39;</span><span class="p">},</span>
             <span class="s1">&#39;recursive&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;partyIds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d40fe&#39;</span><span class="p">,</span> <span class="s1">&#39;lolmao&#39;</span><span class="p">]}}</span>
             <span class="p">}]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">data_sample_expected</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;filter.partyIds=d30dd1cffe&amp;filter.partyIds=5cb1faaac866&amp;pagination.first=5&amp;lol=mao&amp;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nums=1&amp;nums=2&amp;nums=3&amp;a_string=hello&amp;a_dictionary.lol=mao&amp;recursive.filter.partyIds=d40fe&amp;recursive.filter.partyIds=lolmao&amp;&#39;</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">test_build_params</span><span class="p">(</span><span class="n">data_sample_given</span><span class="p">,</span> <span class="n">data_sample_expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">build_params</span><span class="p">(</span><span class="n">data_sample_given</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">data_sample_expected</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">par</span><span class="o">.</span><span class="n">build_params</span><span class="p">(</span><span class="n">data_sample_given</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">data_sample_expected</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

</pre></div>
</div>
</section>
<section id="main-test">
<h3>main test<a class="headerlink" href="#main-test" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pydantic</span>
<span class="kn">import</span> <span class="nn">websockets</span> <span class="k">as</span> <span class="nn">ws</span>  <span class="c1"># websocket refers to another lib called websocket-client</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># import grpc</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">vegavote.exceptions</span> <span class="kn">import</span> <span class="n">RestAPIRequestError</span>
<span class="kn">from</span> <span class="nn">vegavote.store</span> <span class="kn">import</span> <span class="n">vegastore</span> <span class="k">as</span> <span class="n">vs</span>
<span class="kn">from</span> <span class="nn">vegavote.typings</span> <span class="kn">import</span> <span class="n">rest</span>  <span class="c1"># custom Vega typing</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">vegavote.parametrize</span> <span class="kn">import</span> <span class="n">build_params</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="c1"># async with asyncio.timeout(10):  # python ≥ 3.11</span>

<span class="n">mainnet</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># False -&gt; use testnet</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>


<span class="c1"># Get governance data (proposals and votes) for all proposals</span>
<span class="c1"># doing rest api first, switching to grpc afterwards</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">async def get_grpc_data():</span>
<span class="sd">    #  GetProposals(GetProposalsRequest) returns (GetProposalsResponse);</span>
<span class="sd">    async with grpc.aio.insecure_channel(&quot;localhost:50051&quot;) as channel:</span>
<span class="sd">        stub = helloworld_pb2_grpc.GreeterStub(channel)</span>
<span class="sd">        response = await stub.SayHello(helloworld_pb2.HelloRequest(name=&quot;you&quot;))</span>
<span class="sd">    print(&quot;Greeter client received: &quot; + response.message)</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">build_rest_url</span><span class="p">(</span><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">rest_node</span><span class="p">[</span><span class="n">network</span><span class="p">])</span> <span class="o">+</span> <span class="n">endpoint</span>
    <span class="n">parametrized</span> <span class="o">=</span> <span class="n">build_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">parametrized</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">get_rest_data</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">HttpUrl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="c1"># todo: check ratelimit headers</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; rate limit parts returned in headers response</span>
<span class="sd">    &quot;ratelimit-limit&quot;: &quot;1200&quot;,</span>
<span class="sd">    &quot;ratelimit-remaining&quot;: &quot;3999&quot;,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_used</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1"># deal with eg 400 error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># await asyncio.wait_for(session.get(base_url + endpoint), 10)</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">pprint</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>  <span class="c1"># might not work yet</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X-Vega-Node-Id: &quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Vega-Node-Id&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RestAPIRequestError</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">api_used</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ContentTypeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using a Rest API </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> that is unable to return content </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># todo: store as feather, store to db</span>
<span class="c1"># doing rest data first, then comes websockets</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">receive_from_websocket</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">responses_store</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">ws</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">websocket</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ws</span><span class="o">.</span><span class="n">ConnectionClosedOK</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">ws</span><span class="o">.</span><span class="n">ConnectionClosedError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;url is probably invalid: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">. Got error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">responses_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">rest_api_calls</span><span class="p">(</span><span class="n">rest_calls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">pydantic</span><span class="o">.</span><span class="n">HttpUrl</span><span class="p">]):</span>
    <span class="n">endpoint_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;api/v2/(\w+)/(\w+)\?&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>  <span class="c1"># automatic cancellation and exception propagation</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">rest_calls</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">endpoint_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">name_of_task</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no match for your regex on this url: &quot;</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                        <span class="n">get_rest_data</span><span class="p">(</span><span class="n">call</span><span class="p">),</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">task</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_of_task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">result</span><span class="p">()}))</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time taken: &quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tasks finished&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RestQueryBuild</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">pagination</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagination</span> <span class="o">=</span> <span class="n">pagination</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># await receive_from_websocket(url_vega_gov)</span>
    <span class="c1"># running app for mainnet or testnet?</span>
    <span class="c1"># todo: make function doing rest api calls with this task group</span>
    <span class="n">accounts_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;d60d85b145967f53f5714184049a057759a73b0a5757015174a5a652f9715f55&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;5990f199811f234c99259b9c48b52a0bf9198107ab01364ff0c151329aaac899&quot;</span><span class="p">]</span>
    <span class="n">balance_changes</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">ParamsAccountBalanceChanges</span><span class="p">()</span>
    <span class="n">balance_changes</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">partyIds</span> <span class="o">=</span> <span class="n">accounts_to_check</span>
    <span class="n">balance_changes</span><span class="o">.</span><span class="n">pagination</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># retrieve first 5 results</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">balance_changes</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">balance_changes_url</span> <span class="o">=</span> <span class="n">build_rest_url</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">balance_changes</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">list_of_calls_to_make</span> <span class="o">=</span> <span class="p">[</span><span class="n">balance_changes_url</span><span class="p">]</span>  <span class="c1"># set url on model?</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    response headers: </span>
<span class="sd">    &lt;CIMultiDictProxy(&#39;Alt-Svc&#39;: &#39;h3=&quot;:443&quot;; ma=2592000&#39;, &#39;Content-Encoding&#39;: &#39;gzip&#39;, &#39;Content-Length&#39;: &#39;119&#39;,</span>
<span class="sd">    &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Date&#39;: &#39;Sat, 02 Mar 2024 17:43:20 GMT&#39;,</span>
<span class="sd">    &#39;Ratelimit-Limit&#39;: &#39;1200&#39;,</span>
<span class="sd">    &#39;Ratelimit-Remaining&#39;: &#39;3999&#39;,</span>
<span class="sd">    &#39;Ratelimit-Request-Remote-Addr&#39;: &#39;127.0.0.1&#39;,</span>
<span class="sd">    &#39;Ratelimit-Reset&#39;: &#39;1&#39;,</span>
<span class="sd">    &#39;Server&#39;: &#39;Caddy&#39;, &#39;Vary&#39;: &#39;Origin&#39;, &#39;X-Block-Height&#39;: &#39;23919336&#39;, &#39;X-Block-Timestamp&#39;: &#39;1709401363657948000&#39;,</span>
<span class="sd">    &#39;X-Vega-Node-Id&#39;: &#39;n06.test.vega.node&#39;)&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rest_api_calls</span><span class="p">(</span><span class="n">list_of_calls_to_make</span><span class="p">))</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">network</span> <span class="o">=</span> <span class="s2">&quot;mainnet&quot;</span> <span class="k">if</span> <span class="n">mainnet</span> <span class="k">else</span> <span class="s2">&quot;testnet&quot;</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">main</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ai/index.html">ai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx.html">sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/index.html">bash</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="assert.html">assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="asyncio.html">asyncio</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">core</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataclass.html">dataclasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataclass.html#attrs">Attrs</a></li>
<li class="toctree-l2"><a class="reference internal" href="designpatterns.html">design patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_ops.html">glob</a></li>
<li class="toctree-l2"><a class="reference internal" href="functional.html">functional programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="fundamentals.html">fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="pandas.html">pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyenv.html">pyenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex.html">regex</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html">typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#annotated-typing">annotated typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#pydantic">pydantic</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">code library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vim/index.html">vim</a></li>
</ul>

  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">code library</a><ul>
<li><a class="reference internal" href="#parametrize">parametrize</a><ul>
<li><a class="reference internal" href="#pydantic">pydantic</a></li>
<li><a class="reference internal" href="#custom-parametrization">custom parametrization</a></li>
<li><a class="reference internal" href="#main-test">main test</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../vim/index.html" title="vim"
             >next</a> |</li>
        <li class="right" >
          <a href="typing.html" title="typing"
             >previous</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">PowrUsr Docs alpha documentation</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" >python</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">code library</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="search" name="q" id="search-box" />
          <input type="submit" value="Go" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; Copyright 2023, PowrUsr.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    Last updated on 2024-03-03.
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>

  </body>
</html>